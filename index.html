<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revenue Split Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .input-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
            padding-left: 15px;
        }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .param-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .param-row {
            color: white;
            display: grid;
            grid-template-columns: 1fr 200px;
            gap: 15px;
            align-items: center;
        }

        .param-row label {
            margin-bottom: 0;
        }

        .param-row input {
            width: 100%;
        }

        label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #34495e;
        }

        input[type="number"] {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }

        .slider-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .slider-group label {
            font-weight: 600;
            color: #34495e;
            font-size: 16px;
        }
        
        .percentage-labels {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        
        .band-label {
            color: #e74c3c;
            font-size: 14px;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            transition: background 0.3s;
            cursor: pointer;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 2px solid #2980b9;
            transition: all 0.3s;
        }

        .slider::-webkit-slider-thumb:hover {
            background: #2980b9;
            transform: scale(1.1);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
            border: 2px solid #2980b9;
            transition: all 0.3s;
        }

        .slider::-moz-range-thumb:hover {
            background: #2980b9;
            transform: scale(1.1);
        }

        .slider:focus {
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
        }

        .calculation-section {
            background: #ffffff;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .calculation-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-left: 4px solid #e74c3c;
            padding-left: 15px;
        }

        .steps-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .step {
            background: #f1f2f6;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #9b59b6;
        }

        .step h3 {
            color: #8e44ad;
            margin-bottom: 10px;
        }

        .step-detail {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }

        .chart-section {
            background: #ffffff;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .chart-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
            padding-left: 15px;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }

        .attendees-section {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e8e8e8;
        }

        .final-results {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
        }

        .final-results h2 {
            margin-bottom: 20px;
            border: none;
            padding: 0;
        }
        
        .traditional-fee {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }
        
        .traditional-fee h2 {
            margin-bottom: 20px;
            border: none;
            padding: 0;
        }
        
        /* Help System Styles */
        .header {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .help-icon {
            width: 32px;
            height: 32px;
            background-color: #3498db;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: bold;
            color: white;
            font-size: 16px;
        }
        
        .help-icon:hover {
            background-color: #2980b9;
        }
        
        .help-bubble {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            max-width: 600px;
            max-height: 80vh;
            width: 90vw;
            z-index: 1000;
            display: none;
        }
        
        .help-bubble.show {
            display: block;
        }
        
        .help-content {
            padding: 20px;
            overflow-y: auto;
            max-height: 70vh;
            position: relative;
        }
        
        .help-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .help-close:hover {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .help-content h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            margin-top: 0;
            padding-right: 40px;
        }
        
        .help-content p {
            line-height: 1.6;
            margin-bottom: 12px;
            color: #333;
        }
        
        .help-content ul {
            margin: 12px 0;
            padding-left: 20px;
        }
        
        .help-content li {
            line-height: 1.6;
            margin-bottom: 8px;
            color: #333;
        }
        
        /* Overlay background */
        .help-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            display: none;
        }
        
        .help-overlay.show {
            display: block;
        }

        .results-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .result-row {
            display: grid;
            grid-template-columns: 1fr 200px;
            gap: 15px;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: white;
            font-size: 16px;
        }

        .result-value {
            font-size: 20px;
            font-weight: bold;
            color: #0ff1d9;
            text-align: right;
        }

        .result-value.profit {
            color: #2ecc71;
        }

        .result-value.loss {
            color: #e74c3c;
        }

        .intermediate-calc {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .intermediate-calc h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .calc-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }

        /* Mobile Styles - Enhanced for better UX */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 16px;
            }
            
            .container {
                padding: 15px;
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
                box-sizing: border-box;
            }
            
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
                padding-bottom: 10px;
                text-align: center;
            }
            
            .header {
                flex-direction: column;
                align-items: center;
                gap: 15px;
                margin-bottom: 20px;
            }
            
            .help-icon {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 500;
                width: 40px;
                height: 40px;
                font-size: 18px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .input-grid {
                grid-template-columns: 1fr;
            }
            
            .input-section {
                padding: 20px 15px;
                margin-bottom: 20px;
            }
            
            .input-section h2 {
                font-size: 18px;
                margin-bottom: 15px;
            }
            
            .param-container {
                gap: 25px;
            }
            
            .param-row {
                grid-template-columns: 1fr auto;
                gap: 15px;
                padding: 15px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                align-items: center;
            }
            
            .param-row label {
                font-size: 16px;
                font-weight: 600;
                color: #2c3e50;
            }
            
            .param-row input[type="number"] {
                padding: 12px 16px;
                font-size: 18px;
                border: 2px solid #ddd;
                border-radius: 8px;
                width: 120px;
                box-sizing: border-box;
                -webkit-appearance: none;
                -moz-appearance: textfield;
                text-align: right;
            }
            
            .param-row input[type="number"]:focus {
                border-color: #3498db;
                outline: none;
                box-shadow: 0 0 8px rgba(52, 152, 219, 0.3);
            }
            
            /* Slider improvements for mobile */
            .slider-container {
                gap: 30px;
            }
            
            .slider-group {
                background: white;
                padding: 20px 15px;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                gap: 15px;
            }
            
            .percentage-labels {
                margin-bottom: 15px;
            }
            
            .percentage-labels label,
            .band-label {
                font-size: 15px;
                font-weight: 600;
            }
            
            .slider {
                height: 12px;
                border-radius: 6px;
                cursor: pointer;
                margin: 10px 0;
            }
            
            .slider::-webkit-slider-thumb {
                width: 28px;
                height: 28px;
                border-radius: 50%;
                background: #3498db;
                border: 3px solid white;
                box-shadow: 0 2px 6px rgba(0,0,0,0.2);
                cursor: pointer;
                -webkit-appearance: none;
                appearance: none;
            }
            
            .slider::-moz-range-thumb {
                width: 28px;
                height: 28px;
                border-radius: 50%;
                background: #3498db;
                border: 3px solid white;
                box-shadow: 0 2px 6px rgba(0,0,0,0.2);
                cursor: pointer;
            }
            
            /* Chart container mobile optimization */
            .chart-section {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .chart-section h2 {
                font-size: 18px;
                margin-bottom: 15px;
            }
            
            .chart-container {
                height: 300px;
                margin: 15px 0;
                position: relative;
            }
            
            /* Results section mobile improvements */
            .final-results,
            .traditional-fee {
                padding: 20px 15px;
                margin-bottom: 20px;
                border-radius: 8px;
            }
            
            .final-results h2,
            .traditional-fee h2 {
                font-size: 20px;
                margin-bottom: 20px;
                text-align: center;
            }
            
            .result-row {
                grid-template-columns: 1fr auto;
                gap: 15px;
                padding: 15px 0;
                text-align: left;
                align-items: center;
            }
            
            .result-label {
                font-size: 16px;
                font-weight: 600;
            }
            
            .result-value {
                font-size: 22px;
                font-weight: bold;
                text-align: right;
                min-width: 120px;
            }
            
            /* Attendees slider in results - keep original gradient background */
            .final-results .param-row {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                padding: 15px;
                margin-bottom: 20px;
                /* Override the white card background for this special case */
                box-shadow: none !important;
                /* Make slider layout stack vertically on mobile */
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .final-results .param-row label {
                color: white;
                font-size: 16px;
                margin-bottom: 0;
                text-align: center;
            }
            
            .final-results .param-row .slider {
                width: calc(100% - 20px);
                max-width: 230px;
                margin: 0 auto;
                box-sizing: border-box;
            }
            
            /* Traditional fee section - keep original gradient background */
            .traditional-fee .param-row {
                background: rgba(255, 255, 255, 0.1) !important;
                box-shadow: none !important;
            }
            
            .traditional-fee .param-row label {
                color: white !important;
            }
            
            .traditional-fee .param-row input {
                background: rgba(255, 255, 255, 0.9) !important;
                color: #333 !important;
            }
            
            /* Help system mobile improvements */
            .help-bubble {
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                transform: none !important;
                max-width: none !important;
                max-height: none !important;
                width: 100% !important;
                height: 100% !important;
                border-radius: 0 !important;
            }
            
            .help-bubble.show {
                display: flex !important;
                flex-direction: column !important;
            }
            
            .help-content {
                flex: 1 !important;
                padding: 20px !important;
                overflow-y: auto !important;
                max-height: none !important;
            }
            
            .help-content h3 {
                font-size: 20px !important;
                margin-bottom: 15px !important;
                margin-top: 0 !important;
                padding-right: 50px !important;
            }
            
            .help-content p,
            .help-content li {
                font-size: 16px !important;
                line-height: 1.6 !important;
            }
            
            .help-close {
                top: 15px !important;
                right: 20px !important;
                font-size: 28px !important;
                width: 40px !important;
                height: 40px !important;
            }
            
            /* Calculation section mobile */
            .calculation-section {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .calculation-section h2 {
                font-size: 18px;
            }
            
            /* Ensure touch targets are large enough */
            input, button, .slider, .help-icon {
                min-height: 44px;
            }
            
            input {
                min-width: 44px;
            }
            
            .help-icon {
                min-width: 44px;
            }
            
            /* Improve readability with better contrast on mobile */
            .step {
                padding: 20px 15px;
                margin-bottom: 15px;
            }
            
            .step h3 {
                font-size: 16px;
                margin-bottom: 12px;
            }
            
            .intermediate-calc {
                padding: 20px 15px;
                margin-bottom: 20px;
            }
        }
        
        /* Extra small mobile devices */
        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 22px;
            }
            
            .param-row {
                padding: 12px;
            }
            
            .slider-group {
                padding: 15px 12px;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .final-results,
            .traditional-fee {
                padding: 15px 10px;
            }
            
            .help-content {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Revenue Split Calculator</h1>
            <div class="help-icon" id="helpIcon" title="Help">
                <span class="help-text">?</span>
            </div>
        </div>
        
        <div class="help-bubble" id="helpBubble">
            <div class="help-content">
                <div class="help-close" id="helpClose">×</div>






                <h3>Revenue Split Calculator Help</h3>

                <p>This calculator helps you compare two different payment models:</p>
                <ul>
                    <li><strong>3-Step Revenue Split:</strong> A novel revenue-sharing model with multiple tiers</li>
                    <li><strong>Traditional Fixed Fee:</strong> A simple guaranteed payment to the band</li>
                </ul>
                <p>Use the controls above to adjust parameters and see how different scenarios affect payouts for both host and band.</p>

                <h3>Host/Band Split</h3>

                <p>Both the host and the band should be compensated fairly.</p>

                <p>Band cost consists of musician pay, sound cost, transportation, etc. In the current market situation, the band cost is heavily discounted (for example, the band often does not charge extra for acting as sound engineer, $200–500 value).</p>

                <p>Host's costs include room rental, advertising costs, DJ fee, food, organizer's time, etc. The true cost can be hard to estimate.</p>

                <p>Under the traditional model, the host assumes all the risk and is required to pay the band quoted guarantee. The hosts often lose money on live music events and hope to recoup some of it from the profits from other events.</p>

                <p>Under this split formula, there is no band guarantee and the host is given priority of breaking even. The band shares risk and expects to have to co-sponsor the event at average attendance while the host is expected to not lose money. In exchange, the band has a chance to break even or make profit if attendance is better than expected.</p>

                <p>The calculation is split into 3 steps:</p>

                <p><strong>In Step 1</strong>, the host takes the majority of the revenue (as specified by the Step 1 split percentage) until its share of the revenue reaches Host's Cost.</p>

                <p><strong>In Step 2</strong>, the band takes the majority of the revenue (as specified by the Step 2 split percentage) until the band's cost is met. During Step 2, the host has broken even already but the band has not. If there is no revenue remaining in Step 2, both host and the band lost money.</p>

                <p><strong>In Step 3</strong>, if any revenue remains, the host and the band split that revenue according to Step 2 split percentage. Having Step 3 revenue means that both the host and the band broke even.</p>

                <p>To calculate the split, enter the event parameters:</p>

                <ol>
                    <li><strong>Band Cost</strong> as quoted by the band agent. The band cost is often the "union" minimum pay per musician times the number of musicians. The band should expect to lose money at average attendance and make money if the attendance is twice the average.</li>
                    <li><strong>Host Cost</strong> is a reasonable estimate of host's expenses for the event. Inflating the number will increase the band's risk beyond the point of where the band is able to assume it.</li>
                    <li><strong>General Admission price</strong> is the cost of one ticket.</li>
                    <li><strong>Additional revenue</strong> is the actual/estimated amount of extra revenue such as donations or VIP ticket sales.</li>
                    <li><strong>Set step split percentages</strong> with corresponding sliders.</li>
                </ol>

                <p>Setting the input and the sliders plots band/host revenue against the number of attendees.</p>

                <p>Entering the number of attendees also calculates the revenue split for that number.</p>

                <p>Finally, to compare with the traditional model, enter the band guarantee amount in the Traditional Fixed Fee Calculation panel and observe host profit or loss while varying the number of attendees.</p>
            </div>
        </div>

        <div class="input-section">
            <div class="param-container">
                <div class="param-row">
                    <label for="bandBreakEven">Band Cost ($)</label>
                    <input type="number" id="bandBreakEven" value="1200" step="0.01" min="0">
                </div>
                <div class="param-row">
                    <label for="hostBreakEven">Host Cost ($)</label>
                    <input type="number" id="hostBreakEven" value="500" step="0.01" min="0">
                </div>
                <div class="param-row">
                    <label for="generalAdmission">General Admission Price ($)</label>
                    <input type="number" id="generalAdmission" value="25" step="0.01" min="0">
                </div>
                <div class="param-row">
                    <label for="additionalRevenue">Additional Revenue ($)</label>
                    <input type="number" id="additionalRevenue" value="0" step="0.01" min="0">
                </div>
            </div>
        </div>

        <div class="input-section">
            <div class="slider-container">
                <div class="slider-group">
                    <div class="percentage-labels">
                        <label for="step1Host">Step 1: Host Percentage: <span id="step1HostValue">80</span>%</label>
                        <label class="band-label">Band Percentage: <span id="step1BandValue">20</span>%</label>
                    </div>
                    <input type="range" id="step1Host" value="80" min="0" max="100" class="slider">
                </div>
                <div class="slider-group">
                    <div class="percentage-labels">
                        <label for="step2Host">Step 2: Host Percentage: <span id="step2HostValue">20</span>%</label>
                        <label class="band-label">Band Percentage: <span id="step2BandValue">80</span>%</label>
                    </div>
                    <input type="range" id="step2Host" value="20" min="0" max="100" class="slider">
                </div>
                <div class="slider-group">
                    <div class="percentage-labels">
                        <label for="step3Host">Step 3: Host Percentage: <span id="step3HostValue">60</span>%</label>
                        <label class="band-label">Band Percentage: <span id="step3BandValue">40</span>%</label>
                    </div>
                    <input type="range" id="step3Host" value="60" min="0" max="100" class="slider">
                </div>
            </div>
        </div>

        <div class="chart-section">
            <div class="chart-container">
                <canvas id="revenueChart"></canvas>
            </div>

        </div>

        <div class="final-results">
            <h2>Calculation</h2>
            <div class="results-container">
                <div class="param-row">
                    <label for="attendees">Number of Attendees: <span id="attendeesValue">60</span></label>
                    <input type="range" id="attendees" class="slider" value="60" min="0" max="250" step="5">
                </div>
                <div class="result-row">
                    <span class="result-label">Total Revenue</span>
                    <span class="result-value" id="totalRevenue">$0.00</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Total Due Host</span>
                    <span class="result-value" id="totalHost">$0.00</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Total Due Band</span>
                    <span class="result-value" id="totalBand">$0.00</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Host Profit/Loss</span>
                    <span class="result-value" id="hostProfitLoss">$0.00</span>
                </div>
                <div class="result-row">
                    <span class="result-label">Co-Sponsorship Amount</span>
                    <span class="result-value" id="coSponsorshipAmount">$0.00</span>
                </div>
            </div>
        </div>

        <div class="traditional-fee">
            <h2>Traditional Fixed Fee Calculation</h2>
            <div class="results-container">
                <div class="param-row">
                    <label for="bandGuarantee">Band Guarantee ($)</label>
                    <input type="number" id="bandGuarantee" value="800" min="0">
                </div>
                <div class="result-row">
                    <span class="result-label">Host Profit/Loss</span>
                    <span class="result-value" id="traditionalHostProfitLoss">$0.00</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="help-overlay" id="helpOverlay"></div>

    <script>
        // Constants from the Excel sheet
        const STEP1_THRESHOLD = 500; // B3 value

        // Get all input elements
        const inputs = {
            bandBreakEven: document.getElementById('bandBreakEven'),
            hostBreakEven: document.getElementById('hostBreakEven'),
            generalAdmission: document.getElementById('generalAdmission'),
            attendees: document.getElementById('attendees'),
            additionalRevenue: document.getElementById('additionalRevenue'),
            step1Host: document.getElementById('step1Host'),
            step2Host: document.getElementById('step2Host'),
            step3Host: document.getElementById('step3Host'),
            bandGuarantee: document.getElementById('bandGuarantee')
        };
        
        // Help system elements
        const helpIcon = document.getElementById('helpIcon');
        const helpBubble = document.getElementById('helpBubble');
        const helpOverlay = document.getElementById('helpOverlay');
        const helpClose = document.getElementById('helpClose');
        
        // Help system event listeners
        helpIcon.addEventListener('click', function() {
            helpBubble.classList.add('show');
            helpOverlay.classList.add('show');
        });
        
        helpClose.addEventListener('click', function() {
            helpBubble.classList.remove('show');
            helpOverlay.classList.remove('show');
        });
        
        helpOverlay.addEventListener('click', function() {
            helpBubble.classList.remove('show');
            helpOverlay.classList.remove('show');
        });
        
        // Close help bubble with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && helpBubble.classList.contains('show')) {
                helpBubble.classList.remove('show');
                helpOverlay.classList.remove('show');
            }
        });

        // Add event listeners for real-time calculation and chart updates
        Object.values(inputs).forEach(input => {
            input.addEventListener('input', calculateAndUpdateChart);
        });
        
        // Function to update slider display values
        function updateSliderDisplays() {
            // Update Step 1 percentages
            const step1Value = inputs.step1Host.value;
            document.getElementById('step1HostValue').textContent = step1Value;
            document.getElementById('step1BandValue').textContent = 100 - step1Value;
            
            // Update Step 2 percentages
            const step2Value = inputs.step2Host.value;
            document.getElementById('step2HostValue').textContent = step2Value;
            document.getElementById('step2BandValue').textContent = 100 - step2Value;
            
            // Update Step 3 percentages
            const step3Value = inputs.step3Host.value;
            document.getElementById('step3HostValue').textContent = step3Value;
            document.getElementById('step3BandValue').textContent = 100 - step3Value;
            
            // Update attendees count
            document.getElementById('attendeesValue').textContent = inputs.attendees.value;
        }
        
        // Add event listeners for slider value display updates
        inputs.step1Host.addEventListener('input', function() {
            document.getElementById('step1HostValue').textContent = this.value;
            document.getElementById('step1BandValue').textContent = 100 - this.value;
        });
        
        inputs.step2Host.addEventListener('input', function() {
            document.getElementById('step2HostValue').textContent = this.value;
            document.getElementById('step2BandValue').textContent = 100 - this.value;
        });
        
        inputs.step3Host.addEventListener('input', function() {
            document.getElementById('step3HostValue').textContent = this.value;
            document.getElementById('step3BandValue').textContent = 100 - this.value;
        });
        
        inputs.attendees.addEventListener('input', function() {
            document.getElementById('attendeesValue').textContent = this.value;
        });

        function calculate() {
            // Get input values
            const bandBreakEven = parseFloat(inputs.bandBreakEven.value) || 0;
            const hostBreakEven = parseFloat(inputs.hostBreakEven.value) || 0;
            const generalAdmission = parseFloat(inputs.generalAdmission.value) || 0;
            const attendees = parseInt(inputs.attendees.value) || 0;
            const additionalRevenue = parseFloat(inputs.additionalRevenue.value) || 0;
            const step1HostFraction = (parseFloat(inputs.step1Host.value) || 0) / 100;
            const step2HostFraction = (parseFloat(inputs.step2Host.value) || 0) / 100;
            const step3HostFraction = (parseFloat(inputs.step3Host.value) || 0) / 100;

            // Calculate derived fractions
            const step1BandFraction = 1 - step1HostFraction;
            const step2BandFraction = 1 - step2HostFraction;
            const step3BandFraction = 1 - step3HostFraction;

            // Basic calculations (matching Excel formulas)
            const totalRevenue = generalAdmission * attendees + additionalRevenue; // B14 = B5 * B6 + B7
            
            // Step 1 calculations (E column)
            const step1Threshold = STEP1_THRESHOLD / step1HostFraction; // E6 = B3/E3
            const step1Amount = Math.min(totalRevenue, step1Threshold); // E7 = MIN(B14, E6)
            const step1ToHost = step1Amount * step1HostFraction; // E11 = E7 * E3
            const step1ToBand = step1Amount * step1BandFraction; // E12 = E7 * E4
            
            // Remaining after step 1
            const remainingAfterStep1 = Math.max(0, totalRevenue - step1Amount); // E14 = MAX(0, B14-E7)
            
            // Step 2 calculations (H column)
            const step2Threshold = (bandBreakEven - step1ToBand) / step2BandFraction; // H6 = (B2-E12)/H4
            const step2Amount = Math.min(remainingAfterStep1, step2Threshold); // H7 = MIN(E14, H6)
            const step2ToHost = step2Amount * step2HostFraction; // H11 = H7 * H3
            const step2ToBand = step2Amount * step2BandFraction; // H12 = H7 * H4
            
            // Remaining after step 2
            const remainingAfterStep2 = Math.max(0, remainingAfterStep1 - step2Amount); // H14 = MAX(0, E14-H7)
            
            // Step 3 calculations (K column)
            const step3Amount = remainingAfterStep2; // K7 = H14
            const step3ToHost = step3Amount * step3HostFraction; // K11 = K7 * K3
            const step3ToBand = step3Amount * step3BandFraction; // K12 = K7 * K4
            
            // Final totals
            const totalToHost = step1ToHost + step2ToHost + step3ToHost; // N11 = E11+H11+K11
            const totalToBand = step1ToBand + step2ToBand + step3ToBand; // N12 = E12+H12+K12

            // Calculate additional fields (totalRevenue, hostBreakEven, bandBreakEven already calculated above)
            const hostProfitLoss = totalToHost - hostBreakEven;
            const coSponsorshipAmount = Math.max(0, bandBreakEven - totalToBand);
            
            // Update all result displays
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('totalHost').textContent = formatCurrency(totalToHost);
            
            // Update total due band with conditional coloring
            const totalBandElement = document.getElementById('totalBand');
            totalBandElement.textContent = formatCurrency(totalToBand);
            totalBandElement.className = 'result-value ' + (totalToBand >= bandBreakEven ? 'profit' : 'loss');
            
            // Update host profit/loss with conditional coloring
            const hostProfitLossElement = document.getElementById('hostProfitLoss');
            hostProfitLossElement.textContent = formatCurrency(hostProfitLoss);
            hostProfitLossElement.className = 'result-value ' + (hostProfitLoss >= 0 ? 'profit' : 'loss');
            
            // Update co-sponsorship amount
            document.getElementById('coSponsorshipAmount').textContent = formatCurrency(coSponsorshipAmount);
            
            // Traditional Fixed Fee Calculation
            const bandGuarantee = parseFloat(inputs.bandGuarantee.value) || 0;
            const traditionalHostProfitLoss = totalRevenue - bandGuarantee;
            
            // Update traditional host profit/loss with conditional coloring
            const traditionalHostProfitLossElement = document.getElementById('traditionalHostProfitLoss');
            traditionalHostProfitLossElement.textContent = formatCurrency(traditionalHostProfitLoss);
            traditionalHostProfitLossElement.className = 'result-value ' + (traditionalHostProfitLoss >= 0 ? 'profit' : 'loss');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2
            }).format(amount);
        }

        // Find break-even points using B2 and B3 values from spreadsheet
        function findBreakEvenPoints(hostRevenueData, bandRevenueData) {
            const bandBreakEven = parseFloat(inputs.bandBreakEven.value) || 0; // B2
            const hostBreakEven = parseFloat(inputs.hostBreakEven.value) || 500; // B3 from spreadsheet, now user-editable
            
            let hostBreakEvenIndex = null;
            let bandBreakEvenIndex = null;
            
            // Find closest point where host revenue >= host break-even (B3 = $500)
            for (let i = 0; i < hostRevenueData.length; i++) {
                if (hostRevenueData[i] >= hostBreakEven) {
                    hostBreakEvenIndex = i;
                    break;
                }
            }
            
            // Find closest point where band revenue >= band break-even (B2)
            for (let i = 0; i < bandRevenueData.length; i++) {
                if (bandRevenueData[i] >= bandBreakEven) {
                    bandBreakEvenIndex = i;
                    break;
                }
            }
            
            return {
                hostIndex: hostBreakEvenIndex,
                bandIndex: bandBreakEvenIndex,
                hostValue: hostBreakEven,
                bandValue: bandBreakEven
            };
        }

        // Calculate revenue for a specific number of attendees
        function calculateRevenueForAttendees(attendees) {
            // Get current input values
            const bandBreakEven = parseFloat(inputs.bandBreakEven.value) || 0;
            const generalAdmission = parseFloat(inputs.generalAdmission.value) || 0;
            const additionalRevenue = parseFloat(inputs.additionalRevenue.value) || 0;
            const step1HostFraction = (parseFloat(inputs.step1Host.value) || 0) / 100;
            const step2HostFraction = (parseFloat(inputs.step2Host.value) || 0) / 100;
            const step3HostFraction = (parseFloat(inputs.step3Host.value) || 0) / 100;

            // Calculate derived fractions
            const step1BandFraction = 1 - step1HostFraction;
            const step2BandFraction = 1 - step2HostFraction;
            const step3BandFraction = 1 - step3HostFraction;

            // Basic calculations (matching Excel formulas)
            const totalRevenue = generalAdmission * attendees + additionalRevenue;
            
            // Step 1 calculations
            const step1Threshold = STEP1_THRESHOLD / step1HostFraction;
            const step1Amount = Math.min(totalRevenue, step1Threshold);
            const step1ToHost = step1Amount * step1HostFraction;
            const step1ToBand = step1Amount * step1BandFraction;
            
            // Remaining after step 1
            const remainingAfterStep1 = Math.max(0, totalRevenue - step1Amount);
            
            // Step 2 calculations
            const step2Threshold = (bandBreakEven - step1ToBand) / step2BandFraction;
            const step2Amount = Math.min(remainingAfterStep1, step2Threshold);
            const step2ToHost = step2Amount * step2HostFraction;
            const step2ToBand = step2Amount * step2BandFraction;
            
            // Remaining after step 2
            const remainingAfterStep2 = Math.max(0, remainingAfterStep1 - step2Amount);
            
            // Step 3 calculations
            const step3Amount = remainingAfterStep2;
            const step3ToHost = step3Amount * step3HostFraction;
            const step3ToBand = step3Amount * step3BandFraction;
            
            // Final totals
            const totalToHost = step1ToHost + step2ToHost + step3ToHost;
            const totalToBand = step1ToBand + step2ToBand + step3ToBand;

            return {
                totalToHost,
                totalToBand
            };
        }

        // Update the chart when parameters change
        function updateChart() {
            if (revenueChart) {
                // Generate new data points
                const hostRevenueData = [];
                const bandRevenueData = [];
                
                for (let attendees = 0; attendees <= 250; attendees += 5) {
                    const result = calculateRevenueForAttendees(attendees);
                    hostRevenueData.push(result.totalToHost);
                    bandRevenueData.push(result.totalToBand);
                }
                
                // Update datasets
                revenueChart.data.datasets[0].data = hostRevenueData;
                revenueChart.data.datasets[1].data = bandRevenueData;
                
                // Update break-even lines
                const hostBreakEven = parseFloat(inputs.hostBreakEven.value) || 500;
                const bandBreakEven = parseFloat(inputs.bandBreakEven.value) || 1200;
                revenueChart.data.datasets[2].data = Array(hostRevenueData.length).fill(hostBreakEven);
                revenueChart.data.datasets[3].data = Array(bandRevenueData.length).fill(bandBreakEven);
                
                // The vertical line will be redrawn automatically by the plugin
                
                revenueChart.update();
            }
        }
        
        // Custom plugin to draw vertical line
        const verticalLinePlugin = {
            id: 'verticalLine',
            afterDraw: (chart) => {
                if (!chart.scales || !chart.scales.x) return;
                
                const currentAttendees = parseInt(inputs.attendees.value) || 60;
                const ctx = chart.ctx;
                const chartArea = chart.chartArea;
                const xScale = chart.scales.x;
                
                // Calculate x position by finding the index in the labels array
                // Since labels are [0, 5, 10, 15, ..., 250], we need to find the index
                const labels = chart.data.labels;
                const labelIndex = labels.indexOf(currentAttendees);
                
                // If the exact value isn't in labels, find the closest one
                const actualIndex = labelIndex >= 0 ? labelIndex : Math.round(currentAttendees / 5);
                
                // Use the index to get the correct pixel position
                const xPosition = xScale.getPixelForValue(actualIndex);
                
                if (xPosition >= chartArea.left && xPosition <= chartArea.right) {
                    ctx.save();
                    
                    // Draw the vertical line - changed to green
                    ctx.setLineDash([8, 4]);
                    ctx.strokeStyle = '#22c55e'; // Green color
                    ctx.lineWidth = 4;
                    ctx.globalAlpha = 0.9;
                    ctx.beginPath();
                    ctx.moveTo(xPosition, chartArea.top);
                    ctx.lineTo(xPosition, chartArea.bottom);
                    ctx.stroke();
                    
                    // Add label background - changed to green
                    ctx.setLineDash([]);
                    ctx.fillStyle = '#22c55e'; // Green color
                    ctx.globalAlpha = 1;
                    const labelText = `${currentAttendees}`;
                    ctx.font = 'bold 12px Arial';
                    const textMetrics = ctx.measureText(labelText);
                    const labelWidth = textMetrics.width + 12;
                    const labelHeight = 24;
                    const labelX = xPosition - labelWidth / 2;
                    const labelY = chartArea.top - labelHeight - 5;
                    
                    // Draw label background with rounded corners
                    ctx.fillStyle = '#22c55e';
                    ctx.fillRect(labelX, labelY, labelWidth, labelHeight);
                    
                    // Draw label text
                    ctx.fillStyle = 'white';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(labelText, xPosition, labelY + labelHeight / 2);
                    
                    ctx.restore();
                }
            }
        };

        // Modified calculate function to also update chart
        function calculateAndUpdateChart() {
            calculate();
            updateChart();
        }

        // Chart variables
        let revenueChart = null;

        // Register the custom plugin before creating the chart
        if (!Chart.getChart || !Chart.registry.plugins.get('verticalLine')) {
            Chart.register(verticalLinePlugin);
        }
        
        // Create the revenue sweep chart
        function createRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            
            // Generate data points for 0 to 250 attendees in increments of 5 (for chart display)
            const attendeeRange = [];
            const hostRevenueData = [];
            const bandRevenueData = [];
            
            for (let attendees = 0; attendees <= 250; attendees += 5) {
                attendeeRange.push(attendees);
                
                // Calculate revenue for this attendance level
                const result = calculateRevenueForAttendees(attendees);
                hostRevenueData.push(result.totalToHost);
                bandRevenueData.push(result.totalToBand);
            }
            
            revenueChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: attendeeRange,
                    datasets: [{
                        label: 'Host Revenue',
                        data: hostRevenueData,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        tension: 0.1
                    }, {
                        label: 'Band Revenue',
                        data: bandRevenueData,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        tension: 0.1
                    }, {
                        label: 'Host Break-Even',
                        data: Array(attendeeRange.length).fill(parseFloat(inputs.hostBreakEven.value) || 500),
                        borderColor: '#3498db',
                        backgroundColor: 'transparent',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    }, {
                        label: 'Band Break-Even',
                        data: Array(attendeeRange.length).fill(parseFloat(inputs.bandBreakEven.value) || 1200),
                        borderColor: '#e74c3c',
                        backgroundColor: 'transparent',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        pointRadius: 0,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Host vs Band Revenue by Number of Attendees'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Number of Attendees'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Revenue ($)'
                            },
                            beginAtZero: true
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        // Initialize display values to match slider values
        updateSliderDisplays();
        
        // Calculate and create chart on page load
        calculate();
        createRevenueChart();
    </script>
</body>
</html>